# Personalized-Promotions
**Keywords**: Heterogeneous Treatment Effects (HTE), Targeting, Policy Evaluation and Learning

### Summary:
I am working with a real experimental dataset provided by X5 Group, a russian food retailer \href[https://www.x5.ru/en/]. In the experiment, the retailer chose a subgroup of the customer base and sent to half of it an SMS prompting them to perform some action. The other half did not receive any intervention ($T=0$, control group). The experiment was fully randomized, meaning that each customer had a 50% chance of being assigned to the treatment group ($e = 0.5$), regardless of their behavioral or demographic information. The response $Y$ captures whether a customer performed that action that was mentioned in the SMS and is binary ($Y \in \{ 0,1 \}$). The goal of the analysis is to identify the customer profiles that are responsive enough to make the intervention profitable. The customer profiles are summarised by a covariates vector $X$.


### Data:


### Methods
I train multiple $\text{CATE}$ estimators, including **S-Learners**,**T-Learners**, **X-Learners**, **DR-Learners**, **R-Learners**,  **Double Machine Learning** models and **Causal Forests**, and train (and compare) targeting policies based on the estimated heterogeneous treatment effects $\hat{\tau}(x)$. For policy learning I rely on two methods.

1. **First targeting policy**: Treat if $\hat{\tau}(x) \geq \frac{C}{R}$ where $C$ is the cost of treating a sample and $R$ the incremental revenue generated by an additional conversion.

   See also Hitsch, Guenter J. and Misra, Sanjog and Zhang, Walter, Heterogeneous Treatment Effects and Optimal Targeting Policy Evaluation (https://ssrn.com/abstract=3111957)

  
2. **Second targeting policy**: I train a weighted classification model using the covariates $X$ and the label $Y'$, where $Y' =1$ if $\hat{\tau}(x) \geq \frac{C}{R}$ and $0$ otherwise. The weights are proportional to the magnitude of the treatment effect. In particular the weights are calculated based on the expected profit of treating a sample with covariates $X$, $R\cdot \hat{\tau}(x) -C$. They higher this number is, the higher the expected profits/ROI of the promotions for that particular profile. It costs us more missclassifying this sample, than missclassifying another sample with a lower positive value and the second targeting policy takes that into account, whereas the first does not.  

   See also Chapter 15.4 from Chernozhukov, V. & Hansen, C. & Kallus, N. & Spindler, M. & Syrgkanis, V. (2024): Applied Causal Inference Powered by ML and AI (https://causalml-book.org)  
   

  
For policy evaluation I rely on the **Inverse Propensity Scoring** method (If $e(x)$ was not known, we would have to rely on doubly-robust scores $\Gamma_i$ as outlined by Athey and Wager in https://arxiv.org/abs/1702.02896

$$\text{Profits}(\pi) = \sum_{i=1}^n \left ( \frac{1-T_i}{1-e(x_i)} (1 - \pi(x_i)) \cdot RY_i + \frac{T_i}{e(x_i)}\pi(x_i) \cdot (RY_i - C) \right )$$

To estimate the uncertainity around policy performance, I 
   

### Main Results:
The Average Treatment Effect $\text{ATE}$ of the experiment is at 3.12% percent. This uplift 


